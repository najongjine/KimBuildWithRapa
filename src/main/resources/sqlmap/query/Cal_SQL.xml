<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.open.Cal">

	<sql id="Where">
		<if test="schEtc01 == 'POP'">
			AND DATE_FORMAT(DATA_DATE, '%Y.%m.%d') = DATE_FORMAT(NOW(), '%Y.%m.%d')
		</if>
	</sql>
	
	<select id="calSelectList" parameterType="caVO" resultType="caVO">
		/* 해당 월의 데이터 조회 */
		SELECT 
			  DATE_FORMAT(DATA_DATE, '%Y.%m.%d') dataDate
			, CAL_CONT calCont
			, HOL_YN holYn
		FROM T_CALENDAR
		WHERE DATE_FORMAT(DATA_DATE, '%Y%m') = #{schYearMonth}
		AND RGST_ID = #{loginSeq}
		AND USE_YN = 'Y'
		<include refid="Where"/>
		ORDER BY DATA_DATE

	</select>
	
	<select id="selectContents" parameterType="caVO" resultType="caVO">
		/* 해당 일의 데이터 조회  */
		<![CDATA[
		SELECT
			CAL_SEQ calSeq,
			DATE_FORMAT(DATA_DATE, '%Y.%m.%d') dataDate,
			HOL_YN holYn,
			CAL_CONT calCont,
			DATE_FORMAT(RGST_DT, '%Y.%m.%d') rgstDt
		FROM T_CALENDAR
		WHERE DATA_DATE = #{dataDate}
		  AND HOL_YN = 'Y'
		  AND USE_YN = 'Y'
		  	
		UNION
		
		SELECT
			CAL_SEQ calSeq,
			DATE_FORMAT(DATA_DATE, '%Y.%m.%d') dataDate,
			HOL_YN holYn,
			CAL_CONT calCont,
			DATE_FORMAT(RGST_DT, '%Y.%m.%d') rgstDt
		FROM T_CALENDAR
		WHERE DATA_DATE = #{dataDate}
		  AND HOL_YN <> 'Y'
		  AND RGST_ID = #{loginSeq}
		  AND USE_YN = 'Y'
		]]>
	</select>
	
	<update id="deleteContents" parameterType="caVO">
		/* 데이터 삭제 */
		UPDATE T_CALENDAR
		SET USE_YN = 'N'
		WHERE CAL_SEQ = #{calSeq}
	</update>
	
	<insert id="insertContents" parameterType="caVO">
		/* 데이터 입력 */
		INSERT INTO T_CALENDAR(
			  DATA_DATE
			, CAL_CONT
			, RGST_ID
			, HOL_YN
		)VALUES(
			  STR_TO_DATE(#{dataDate ,jdbcType=VARCHAR},'%Y-%m-%d')
			, #{calCont ,jdbcType=VARCHAR}
			, #{loginSeq}
			, IFNULL(#{holYn ,jdbcType=VARCHAR}, 'N'))
	</insert>
	
	<update id="updateContents" parameterType="caVO">
		/* 데이터 수정 */
		UPDATE T_CALENDAR
		SET CAL_CONT = #{calCont ,jdbcType=VARCHAR},
			DATA_DATE = #{dataDate ,jdbcType=VARCHAR},
			HOL_YN = NVL(#{holYn ,jdbcType=VARCHAR}, 'N'),
			RVSE_ID = #{loginSeq},
			RVSE_DT = NOW()
		WHERE CAL_SEQ = #{calSeq}	
	</update>
	

	
</mapper>